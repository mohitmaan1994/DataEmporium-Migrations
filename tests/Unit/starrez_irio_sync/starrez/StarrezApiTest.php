<?php

namespace App\libraries\starrez_irio_sync\starrez;

use App\libraries\starrez_irio_sync\models\SyncEntityExtended;
use GuzzleHttp\Client;
use GuzzleHttp\Exception\RequestException;
use GuzzleHttp\Handler\MockHandler;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Psr7\Request;
use GuzzleHttp\Psr7\Response;
use Illuminate\Foundation\Http\Kernel;
use PHPUnit\Framework\TestCase;

class StarrezApiTest extends TestCase
{
    private $starrezApi;

    public function testGetEntriesForSuccessfulApiResponse()
    {
        $starrezApiResponse = '[{"EntryID":118492,"CategoryID":0,"EventID":0,"ContactID":0,"EntryStatusEnum":"History","AddressTypeID":6,"BookingID":77985,"EntryApplicationID":0,"PinNumber":670253,"Password":"","PortalEmail":"","PortalAuthProviderUserID":"","AgentPassword":"","AgentPasswordResetExpiryDate":"","NameLast":".Test","NameFirst":".Claudia_Sosa","NameTitle":"","NamePreferred":"","NameWeb":"Blues Clues","NameOther":"","NameInitials":"","NameSharer":"","GenderEnum":"Female","Birth_GenderEnum":"Female","DirectoryFlagPrivacy":false,"DOB":"1997-08-28T00:00:00","Position":"","ID1":"040109","ID2":"","ID3":"","ID4":0,"ID5":0,"PhoneProcessToAccount":true,"PhoneChargeTypeID":0,"PhoneDisableValue":0,"PhoneRestrictValue":0,"PhoneControlEnum":"Default","TaxExemptionEnum":"None","LastCheckInOutDate":"","Previous_EntryStatusEnum":"Reserved","Testing":true,"User_SecurityUserID":0,"SecurityUserID":315,"CreatedBy_SecurityUserID":315,"DateCreated":"2017-08-01T14:29:00","DateModified":"2018-10-30T12:53:24","EntryAddress":[{"EntryAddressID":1287465,"EntryID":118492,"AddressTypeID":0,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287466,"EntryID":118492,"AddressTypeID":1,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287467,"EntryID":118492,"AddressTypeID":2,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287468,"EntryID":118492,"AddressTypeID":3,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"9798454744","PhoneOther":"","PhoneOther2":"","Email":"claudia_sosa@housing.tamu.edu","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287469,"EntryID":118492,"AddressTypeID":4,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287470,"EntryID":118492,"AddressTypeID":5,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287471,"EntryID":118492,"AddressTypeID":6,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287472,"EntryID":118492,"AddressTypeID":7,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287473,"EntryID":118492,"AddressTypeID":8,"Salutation":"","ContactName":"test","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"9798454744","PhoneOther":"","PhoneOther2":"","Email":"claudia_sosa@housing.tamu.edu","Relationship":"Partner","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287474,"EntryID":118492,"AddressTypeID":9,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1287475,"EntryID":118492,"AddressTypeID":10,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2017-08-06T01:57:26"},{"EntryAddressID":1792756,"EntryID":118492,"AddressTypeID":11,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2018-07-12T15:42:25"},{"EntryAddressID":2430267,"EntryID":118492,"AddressTypeID":12,"Salutation":"","ContactName":"","ContactName2":"","Street":"","Street2":"","City":"","CountryID":0,"StateProvince":"","ZipPostcode":"","Phone":"","PhoneMobileCell":"","PhoneOther":"","PhoneOther2":"","Email":"","Relationship":"","ActiveDateStart":"","ActiveDateEnd":"","Reference":"","Comments":"","DateModified":"2019-09-27T17:32:09"}],"Booking":[{"BookingID":67920,"RoomSpaceID":13788,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":20,"GroupID":0,"RoomLocationID":24,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":45,"BookingLinkTypeEnum":"None","TermSessionID":9,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":828,"CheckInDate":"2017-08-03T00:00:00","CheckOutDate":"2017-08-20T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2017-08-03T00:00:00","ContractDateStart":"2017-08-03T00:00:00","ContractDateEnd":"2017-08-20T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2017-08-03T15:14:21","DateCreated":"2017-08-03T14:56:00","DateModified":"2017-08-03T15:14:21"},{"BookingID":67921,"RoomSpaceID":3446,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":36,"GroupID":0,"RoomLocationID":5,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":14,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":4323,"CheckInDate":"2017-08-20T00:00:00","CheckOutDate":"2017-12-16T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2017-08-20T00:00:00","ContractDateStart":"2017-08-20T00:00:00","ContractDateEnd":"2017-12-16T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":27,"DateModifiedBilling":"2017-08-03T15:16:35","DateCreated":"2017-08-03T15:16:00","DateModified":"2017-08-03T15:16:34"},{"BookingID":67922,"RoomSpaceID":3446,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":36,"GroupID":0,"RoomLocationID":5,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":15,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":4323,"CheckInDate":"2018-01-11T00:00:00","CheckOutDate":"2018-05-12T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-01-11T00:00:00","ContractDateStart":"2018-01-11T00:00:00","ContractDateEnd":"2018-05-12T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":27,"DateModifiedBilling":"2017-08-03T15:16:39","DateCreated":"2017-08-03T15:16:00","DateModified":"2017-08-03T15:16:39"},{"BookingID":67968,"RoomSpaceID":13788,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":20,"GroupID":0,"RoomLocationID":24,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":45,"BookingLinkTypeEnum":"None","TermSessionID":9,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":828,"CheckInDate":"2017-08-07T00:00:00","CheckOutDate":"2017-08-20T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2017-08-07T00:00:00","ContractDateStart":"2017-08-07T00:00:00","ContractDateEnd":"2017-08-20T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2017-09-29T14:29:00","DateCreated":"2017-08-07T09:59:00","DateModified":"2017-09-29T14:29:00"},{"BookingID":71019,"RoomSpaceID":8766,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":25,"GroupID":0,"RoomLocationID":15,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":14,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":3232,"CheckInDate":"2017-08-21T00:00:00","CheckOutDate":"2017-12-16T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2017-08-21T00:00:00","ContractDateStart":"2017-08-21T00:00:00","ContractDateEnd":"2017-12-16T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2017-08-21T15:16:35","DateCreated":"2017-08-21T15:16:00","DateModified":"2017-08-21T15:16:36"},{"BookingID":71020,"RoomSpaceID":8766,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":25,"GroupID":0,"RoomLocationID":15,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":15,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":3232,"CheckInDate":"2018-01-11T00:00:00","CheckOutDate":"2018-05-10T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-01-11T00:00:00","ContractDateStart":"2018-01-11T00:00:00","ContractDateEnd":"2018-05-10T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2017-08-21T15:16:42","DateCreated":"2017-08-21T15:16:00","DateModified":"2017-12-12T10:11:15"},{"BookingID":75811,"RoomSpaceID":10592,"EntryID":118492,"EntryStatusEnum":"History","RoomTypeID":20,"GroupID":0,"RoomLocationID":20,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":15,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":3232,"CheckInDate":"2018-01-26T00:00:00","CheckOutDate":"2018-05-12T00:00:00","ETA":"2019-12-04T10:43:00","ETD":"2019-12-04T20:27:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-05-12T00:00:00","ContractDateStart":"2018-01-26T00:00:00","ContractDateEnd":"2018-05-12T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"2018-01-26T14:46:09","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":311,"DateModifiedBilling":"2018-01-26T10:42:29","DateCreated":"2018-01-26T10:42:00","DateModified":"2018-01-27T20:26:36"},{"BookingID":75823,"RoomSpaceID":10592,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":20,"GroupID":0,"RoomLocationID":20,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":24,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":3329,"CheckInDate":"2019-01-10T00:00:00","CheckOutDate":"2019-05-11T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2019-01-10T00:00:00","ContractDateStart":"2019-01-10T00:00:00","ContractDateEnd":"2019-05-11T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"StarRezPortal","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":13,"DateModifiedBilling":"2018-02-20T10:19:43","DateCreated":"2018-01-26T13:32:00","DateModified":"2018-02-20T10:19:43"},{"BookingID":76025,"RoomSpaceID":10058,"EntryID":118492,"EntryStatusEnum":"History","RoomTypeID":25,"GroupID":0,"RoomLocationID":18,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":25,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":3232,"CheckInDate":"2018-01-29T00:00:00","CheckOutDate":"2018-05-12T00:00:00","ETA":"2019-12-04T12:32:00","ETD":"2019-12-04T12:39:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-05-12T00:00:00","ContractDateStart":"2018-01-29T00:00:00","ContractDateEnd":"2018-05-12T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"2018-01-29T14:46:08","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":8,"DateModifiedBilling":"2018-01-29T12:31:36","DateCreated":"2018-01-29T12:32:00","DateModified":"2018-01-29T14:45:08"},{"BookingID":77985,"RoomSpaceID":3339,"EntryID":118492,"EntryStatusEnum":"History","RoomTypeID":47,"GroupID":0,"RoomLocationID":5,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":41,"BookingLinkTypeEnum":"None","TermSessionID":25,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":4061,"CheckInDate":"2018-03-02T00:00:00","CheckOutDate":"2018-05-12T00:00:00","ETA":"2019-12-04T12:53:00","ETD":"2019-12-04T13:42:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-05-12T00:00:00","ContractDateStart":"2018-03-02T00:00:00","ContractDateEnd":"2018-05-12T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"2018-03-02T14:46:10","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":8,"DateModifiedBilling":"2018-03-02T12:52:30","DateCreated":"2018-03-02T12:53:00","DateModified":"2018-03-02T14:45:09"},{"BookingID":113445,"RoomSpaceID":22033,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":84,"GroupID":0,"RoomLocationID":20,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":23,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":2262,"CheckInDate":"2018-08-19T00:00:00","CheckOutDate":"2018-12-15T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-08-19T00:00:00","ContractDateStart":"2018-08-19T00:00:00","ContractDateEnd":"2018-12-15T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2018-08-16T08:02:21","DateCreated":"2018-08-16T07:22:00","DateModified":"2018-08-16T08:02:21"},{"BookingID":113446,"RoomSpaceID":22033,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":84,"GroupID":0,"RoomLocationID":20,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":24,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":2262,"CheckInDate":"2019-01-10T00:00:00","CheckOutDate":"2019-05-11T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2019-01-10T00:00:00","ContractDateStart":"2019-01-10T00:00:00","ContractDateEnd":"2019-05-11T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2018-08-16T08:06:31","DateCreated":"2018-08-16T07:23:00","DateModified":"2018-08-16T08:06:31"},{"BookingID":113476,"RoomSpaceID":18796,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":84,"GroupID":0,"RoomLocationID":21,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":23,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":2262,"CheckInDate":"2018-08-19T00:00:00","CheckOutDate":"2018-12-15T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-08-19T00:00:00","ContractDateStart":"2018-08-19T00:00:00","ContractDateEnd":"2018-12-15T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2018-09-10T12:20:14","DateCreated":"2018-08-17T10:25:00","DateModified":"2018-09-10T12:20:14"},{"BookingID":113477,"RoomSpaceID":18796,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":84,"GroupID":0,"RoomLocationID":21,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":24,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":2262,"CheckInDate":"2019-01-10T00:00:00","CheckOutDate":"2019-05-11T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2019-01-10T00:00:00","ContractDateStart":"2019-01-10T00:00:00","ContractDateEnd":"2019-05-11T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2018-09-10T12:22:28","DateCreated":"2018-08-17T10:26:00","DateModified":"2018-09-10T12:22:28"},{"BookingID":116711,"RoomSpaceID":3402,"EntryID":118492,"EntryStatusEnum":"Cancelled","RoomTypeID":47,"GroupID":0,"RoomLocationID":5,"Start_BookingReasonID":0,"End_BookingReasonID":0,"BookingTypeID":0,"RoomRateID":60,"BookingLinkTypeEnum":"None","TermSessionID":23,"HousekeepingID":0,"EntryInvitationID":0,"RoomLocationFixed":true,"RoomRateAmount":4183,"CheckInDate":"2018-11-01T00:00:00","CheckOutDate":"2018-12-15T00:00:00","ETA":"2019-12-04T00:00:00","ETD":"2019-12-04T00:00:00","CheckInDateActual":"","CheckOutDateActual":"","DateChargedTo":"2018-12-15T00:00:00","ContractDateStart":"2018-10-22T00:00:00","ContractDateEnd":"2018-12-15T00:00:00","ResvChargeToEntry":true,"NumberOfGuests":1,"NumberOfGuestsFree":0,"NumberOfChildren":0,"NumberOfChildrenFree":0,"SpecialRequirement":"","Comments":"","DateBilled":"2018-10-23T14:31:10","AutoAllocationDetail":"","CustomBit1":false,"CustomBit2":false,"CustomBit3":false,"CustomBit4":false,"CustomString1":"","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomString7":"","CustomString8":"","CustomString9":"","CustomString10":"","CustomDate1":"","CustomDate2":"","CustomDate3":"","CustomDate4":"","SecurityUserID":315,"DateModifiedBilling":"2018-10-30T12:53:23","DateCreated":"2018-10-22T16:28:00","DateModified":"2018-10-30T12:53:24"}]}]';
        $mock = new MockHandler([
            new Response(200, ['X-Foo' => 'Bar'], $starrezApiResponse)
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);
        $starrezApiResponseMapperResponse = array(new SyncEntityExtended(), new SyncEntityExtended());
        $starrezApiResponseMapperMock->method('mapToSyncEntityExtendedArray')
            ->willReturn($starrezApiResponseMapperResponse);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);
        $getEntriesQueryParams = array(
            '_pageIndex' => 23,
            '_pageSize' => 500,
            '_relatedTables' => ['EntryAddress', 'Booking']
        );

        $this->assertEquals($starrezApiResponseMapperResponse, $this->starrezApi->getEntries($getEntriesQueryParams), "The returned value does not match mock values");
    }

    public function testGetEntriesForUnsuccessfulApiResponse()
    {
        $mock = new MockHandler([
            new RequestException('Error Communicating with Server', new Request('GET', 'test'))
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);

        $this->expectException(\Exception::class);

        $getEntriesQueryParams = array(
            '_pageIndex' => 23,
            '_pageSize' => 500,
            '_relatedTables' => ['EntryAddress', 'Booking']
        );
        $this->starrezApi->getEntries($getEntriesQueryParams);
    }

    public function testGetRoomNumberForSuccessfulApiResponse()
    {
        $starrezApiResponse = '[{"RoomSpaceID":14414,"RoomBaseID":10347,"RoomSpaceTypeEnum":"Bed","RecordTypeEnum":"Normal","RoomID":10347,"Description":"SCHU-114-A1","WebDescription":"","ExtensionID":0,"SortOrder":0,"RoomRateID":0,"AllocateSortOrder":0,"AllocateExclude":false,"Hold":false,"Networked":false,"BedCapacity":1,"Bathrooms":0,"Street":"308 University Drive","Street2":"","Comments":"","SecurityUserID":0,"DateModified":"2017-08-06T01:56:55"}]';
        $mock = new MockHandler([
            new Response(200, ['X-Foo' => 'Bar'], $starrezApiResponse)
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);
        $starrezApiResponseMapperResponse = 'SCHU-114-A1';
        $starrezApiResponseMapperMock->method('extractRoomNumber')
            ->willReturn($starrezApiResponseMapperResponse);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);

        $this->assertEquals($starrezApiResponseMapperResponse, $this->starrezApi->getRoomNumber(14414), "The returned value does not match mock values");
    }

    public function testGetRoomNumberForUnsuccessfulApiResponse()
    {
        $mock = new MockHandler([
            new RequestException('Error Communicating with Server', new Request('GET', 'test'))
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);

        $this->expectException(\Exception::class);

        $this->starrezApi->getRoomNumber(14414);
    }

    public function testGetRoomLocationForSuccessfulApiResponse()
    {
        $starrezApiResponse = '[{"RoomLocationID":27,"RecordTypeEnum":"Normal","RoomLocationAreaID":5,"CategoryID":0,"NonResidential":false,"Description":"Schuhmacher Hall","Comments":"","Lease":false,"AllocateSortOrder":0,"City":"College Station","CountryID":247,"StateProvince":"TX","ZipPostcode":"77840","GenderTypeEnum":"DynamicGender","ManagedExternally":false,"CustomBit1":false,"CustomBit2":false,"CustomString1":"SCHU","CustomString2":"","CustomString3":"","CustomString4":"","CustomString5":"","CustomString6":"","CustomDate1":"","CustomDate2":"","ViewOnWeb":true,"WebImageLocation":"http://oncampusaggies.tamu.edu/Images/Site/TAMU/GALLERY_Schuhmacher_Exterior.jpg","WebDescription":"","WebComments":"Gender: Coed  \r\nBathroom Style: Suite  \r\nArea: Northside  \r\nKitchen: Yes  \r\nBedroom Flooring: Vinyl Composite Tile","DateModified":"2019-11-11T16:08:59"}]';
        $mock = new MockHandler([
            new Response(200, ['X-Foo' => 'Bar'], $starrezApiResponse)
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);
        $starrezApiResponseMapperResponse = 'Schuhmacher Hall';
        $starrezApiResponseMapperMock->method('extractRoomLocation')
            ->willReturn($starrezApiResponseMapperResponse);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);

        $this->assertEquals($starrezApiResponseMapperResponse, $this->starrezApi->getRoomLocation(27), "The returned value does not match mock values");
    }

    public function testGetRoomLocationForUnsuccessfulApiResponse()
    {
        $mock = new MockHandler([
            new RequestException('Error Communicating with Server', new Request('GET', 'test'))
        ]);
        $handlerStack = HandlerStack::create($mock);
        $client = new Client(['handler' => $handlerStack]);

        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);

        $this->starrezApi = new StarrezApi($client, $starrezApiResponseMapperMock);

        $this->expectException(\Exception::class);

        $this->starrezApi->getRoomLocation(27);
    }

    public function testEndpointPathWithRelatedTablesArgument()
    {
        $guzzleHttpClientMock = $this->createMock(Client::class);
        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);

        $this->starrezApi = new StarrezApi($guzzleHttpClientMock, $starrezApiResponseMapperMock);
        $getEntriesQueryParams = array(
            '_pageIndex' => 23,
            '_pageSize' => 500,
            '_relatedTables' => ['EntryAddress', 'Booking']
        );
        $endpointPath = "_pageIndex=23&_pageSize=500&_relatedTables=EntryAddress&_relatedTables=Booking";
        $this->assertSame($endpointPath, $this->starrezApi->getQueryStringFromQueryParamsArray($getEntriesQueryParams),
            'Resultant endpoint path does not match the expected one');
    }

    public function testEndpointPathWithoutRelatedTablesArgument()
    {
        $guzzleHttpClientMock = $this->createMock(Client::class);
        $starrezApiResponseMapperMock = $this->createMock(StarrezApiResponseMapper::class);

        $this->starrezApi = new StarrezApi($guzzleHttpClientMock, $starrezApiResponseMapperMock);
        $getEntriesQueryParams = array(
            '_pageIndex' => 23,
            '_pageSize' => 500
        );
        $endpointPath = "_pageIndex=23&_pageSize=500";
        $this->assertSame($endpointPath, $this->starrezApi->getQueryStringFromQueryParamsArray($getEntriesQueryParams),
            'Resultant endpoint path does not match the expected one');
    }
}
